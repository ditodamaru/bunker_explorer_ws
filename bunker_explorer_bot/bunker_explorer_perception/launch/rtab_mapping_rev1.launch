  <launch>
    <!--
    <arg name="localization" default="false"/> <! for localization
    <arg name="rtabmap_args" default="delete_db_on_start"/>  for mapping 
    -->

    <!-- references --> 
    <!-- https://github.com/introlab/rtabmap_ros/blob/master/rtabmap_demos/launch/demo_stereo_outdoor.launch -->
    <!-- http://wiki.ros.org/rtabmap_ros/Tutorials/StereoHandHeldMapping-->
    <!-- reference for RGBD-SLAM RTABMAP https://github.com/sunsided/RoboND-MapMyWorld/blob/master/src/map_my_world/launch/mapping.launch-->
    <!-- reference for http://wiki.ros.org/rtabmap_ros/Tutorials/HandHeldMapping -->

    <!-- Choose visualization -->
    <arg name="rviz" default="true" />
    <arg name="rtabmap_viz" default="false" />
    <arg name="local_bundle" default="true" />
    <arg name="stereo_sync" default="false" />    

    <arg name="use_sim_time" type="bool" value="true"/>    


    <arg name="database_path" default="~/.ros/rtabmap.db"/>


    <!-- Choose between mapping and localization-->
    <!--
    <arg name="stereo"                    default="false"/>
    <arg     if="$(arg stereo)" name="depth"  default="false"/>
    <arg unless="$(arg stereo)" name="depth"  default="true"/> 
    -->

    <!-- pengaturan default untuk mapping
    <arg name="function" default="true"/> < untuk mapping 
    <arg    if="$(arg function)" name="rtabmap_args" default="-delete_db_on_start"/>
    <arg unless="$(arg function)" name="localization"  default="true"/>
    -->

    <!-- pengaturan default untuk mapping -->
    <arg name="localization"            default="false"/>
    <arg name="args"                    default=""/>              <!-- delete_db_on_start, udebug -->
    <arg name="rtabmap_args"            default="$(arg args)"/>   <!-- deprecated, use "args" argument -->


    <!-- example 
    <arg name="args"                    default=""/>              <- delete_db_on_start, udebug ->
    <arg name="rtabmap_args"            default="$(arg args)"/>   <- deprecated, use "args" argument ->
    <arg name="gdb"                     default="false"/>         <- Launch nodes in gdb for debugging (apt install xterm gdb) ->
    <arg     if="$(arg gdb)" name="launch_prefix" default="xterm -e gdb -q -ex run -args"/>
    <arg unless="$(arg gdb)" name="launch_prefix" default=""/> -->

    <node name="localization_data_pub_node" pkg="localization_data_pub" type="rviz_click_to_2d" output="screen">
            <!-- Add any necessary arguments here -->
            <!-- <param name="param_name" value="param_value" /> -->
    </node>

    <group ns="rtabmap">
        <node pkg="nodelet" type="nodelet" name="rgbd_sync" args="standalone rtabmap_ros/rgbd_sync" output="screen">
            <remap from="rgb/image"       to="/camera/color/image_raw"/>
            <remap from="depth/image"     to="/camera/aligned_depth_to_color/image_raw"/>
            <remap from="rgb/camera_info" to="/camera/color/camera_info"/>
            <remap from="rgbd_image"      to="rgbd_image"/> <!-- output -->
            
            <!-- Should be true for not synchronized camera topics 
                (e.g., false for kinectv2, zed, realsense, true for xtion, kinect360)-->
            <param name="approx_sync"       value="false"/> 
        </node>

        <!-- Visual SLAM: args: "delete_db_on_start" and "udebug" -->
        <node name="rtabmap" pkg="rtabmap_slam" type="rtabmap" output="screen" args="--delete_db_on_start">
            <param name="frame_id"         type="string" value="base_footprint"/>
            <param unless="$(arg stereo_sync)" name="subscribe_stereo" type="bool" value="true"/>
            <param name="subscribe_depth"  type="bool" value="false"/>
            <param name="subscribe_rgbd"      type="bool" value="$(arg stereo_sync)"/>

            <!-- database setting -->
            <param name="rtabmap_args" value="$(arg rtabmap_args)"/>

            <!--subscription-->
            <!-- original -->
            <!-- <remap from="left/image_rect"   to="/stereo_camera/left/image_rect_color"/>
                <remap from="right/image_rect"  to="/stereo_camera/right/image_rect"/>
                <remap from="left/camera_info"  to="/stereo_camera/left/camera_info_throttle"/>
                <remap from="right/camera_info" to="/stereo_camera/right/camera_info_throttle"/>
                <remap from="rgbd_image"        to="/stereo_camera/rgbd_image"/> -->

            <!--RealSense D435i camera (stereo IR):

                $ roslaunch rtabmap_launch rtabmap.launch \
                rtabmap_args:="-delete_db_on_start" \
                left_image_topic:=/camera/infra1/image_rect_raw \
                right_image_topic:=/camera/infra2/image_rect_raw \
                left_camera_info_topic:=/camera/infra1/camera_info \
                right_camera_info_topic:=/camera/infra2/camera_info \
                stereo:=true \
                wait_imu_to_init:=true \
                imu_topic:=/rtabmap/imu -->

            <!-- RealSense D435i camera (IR-Depth):

                $ roslaunch rtabmap_launch rtabmap.launch \
                rtabmap_args:="-delete_db_on_start" \
                rgb_topic:=/camera/infra1/image_rect_raw \
                depth_topic:=/camera/depth/image_rect_raw \
                camera_info_topic:=/camera/infra1/camera_info \
                wait_imu_to_init:=true \
                imu_topic:=/rtabmap/imu -->

            <remap from="left/image_rect" to="/camera/infra1/image_rect_raw"/>
            <remap from="right/image_rect" to="/camera/infra2/image_rect_raw"/> 
            <remap from="left/camera_info"  to="/camera/infra1/camera_info"/>
            <remap from="left/camera_info" to="/camera/infra1/camera_info"/>
            <remap from="rgbd_image"        to="/stereo_camera/">

            <param name="approx_sync" value="false"/>

            <remap from="odom" to="/odom"/>

            <param name="queue_size" type="int" value="30"/>
            <param name="map_negative_poses_ignored" type="bool" value="true"/>

            <!-- RTAB-Map's parameters -->
            <param name="Rtabmap/TimeThr"                   type="string" value="700"/>
            <param name="Grid/DepthDecimation"              type="string" value="4"/>
            <param name="Grid/FlatObstacleDetected"         type="string" value="true"/>
            <param name="Kp/MaxDepth"                       type="string" value="0"/>
            <param name="Kp/DetectorStrategy"               type="string" value="6"/>
            <param name="Vis/EstimationType"                type="string" value="1"/>   <!-- 0=3D->3D, 1=3D->2D (PnP) -->
            <param name="Vis/MaxDepth"                      type="string" value="0"/>
            <param name="RGBD/CreateOccupancyGrid"          type="string" value="true"/>
        </node>

        <!-- Visualisation RTAB-Map -->
        <node if="$(arg rtabmap_viz)" pkg="rtabmap_viz" type="rtabmap_viz" name="rtabmap_viz" args="-d $(find rtabmap_demos)/launch/config/rgbd_gui.ini" output="screen">
            <param unless="$(arg stereo_sync)" name="subscribe_stereo"    type="bool" value="true"/>
            <param name="subscribe_odom_info" type="bool" value="true"/>
            <param name="subscribe_rgbd"      type="bool" value="$(arg stereo_sync)"/>
            <param name="queue_size"          type="int" value="10"/>
            <param name="frame_id"            type="string" value="base_footprint"/>

            <!--original depth camera subscripstion -->
            <!--   <remap from="left/image_rect"  to="/stereo_camera/left/image_rect_color"/>
                <remap from="right/image_rect"  to="/stereo_camera/right/image_rect"/>
                <remap from="left/camera_info"  to="/stereo_camera/left/camera_info_throttle"/>
                <remap from="right/camera_info" to="/stereo_camera/right/camera_info_throttle"/> 
                <remap from="rgbd_image"          to="/stereo_camera/rgbd_image"/> -->
            <remap from="odom_info"         to="odom_info"/>
            <remap from="odom"              to="/odom"/>
            <remap from="mapData"           to="mapData"/>
        </node>

        <!-- Visualisation RVIZ -->        
    </group>

   <!-- Visualisation RVIZ -->
   <node if="$(arg rviz)" pkg="rviz" type="rviz" name="rviz" args="-d $(find rtabmap_demos)/launch/config/demo_stereo_outdoor.rviz"/>

</launch>